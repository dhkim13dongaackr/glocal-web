<!DOCTYPE html>
<html>
<head>
    <title>Design Previews - Glocal Web</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script>
        // Force reload if needed
        if (!window.location.search.includes('t=')) {
             // Optional: Uncomment to force timestamp on URL
             // window.location.search = 't=' + Date.now();
        }

        // Smarter Refresh: Only refresh if no interaction for 5 seconds
        let idleTime = 0;
        document.addEventListener('mousemove', () => idleTime = 0);
        document.addEventListener('keydown', () => idleTime = 0);
        
        setInterval(() => {
            idleTime++;
            if (idleTime > 2) { // Reload after 2 seconds of idleness
                // window.location.reload(); 
                // Disabled full reload to prevent iframe flickering. 
                // We rely on manual refresh or specific updates for better UX with iframes.
            }
        }, 1000);

        // Keyboard Navigation
        let focusedIndex = 0;
        
        document.addEventListener('DOMContentLoaded', () => {
            // Cache Busting for Iframes
            document.querySelectorAll('iframe.thumb-frame').forEach(iframe => {
                const src = iframe.getAttribute('src');
                if (src) {
                    iframe.setAttribute('src', src + '?t=' + Date.now());
                }
            });

            const cards = document.querySelectorAll('.version-card');
            if(cards.length > 0) focusCard(0);

            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight') {
                    moveFocus(1);
                } else if (e.key === 'ArrowLeft') {
                    moveFocus(-1);
                } else if (e.key === 'Enter') {
                    const cards = document.querySelectorAll('.version-card');
                    if (cards[focusedIndex]) {
                        window.location.href = cards[focusedIndex].getAttribute('href');
                    }
                } else if (e.key === '1' || e.code === 'KeyL') {
                    if (cards[0]) window.location.href = cards[0].getAttribute('href');
                }
            });
        });

        function moveFocus(direction) {
            const cards = document.querySelectorAll('.version-card');
            focusedIndex += direction;
            if (focusedIndex < 0) focusedIndex = cards.length - 1;
            if (focusedIndex >= cards.length) focusedIndex = 0;
            focusCard(focusedIndex);
        }

        function focusCard(index) {
            const cards = document.querySelectorAll('.version-card');
            cards.forEach(c => c.classList.remove('focused'));
            if (cards[index]) {
                cards[index].classList.add('focused');
                cards[index].scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    </script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 40px; background: #f5f5f7; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        h1 { font-size: 32px; font-weight: 800; color: #111; margin: 0; }
        .refresh-btn { padding: 8px 16px; background: white; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; font-weight: 600; color: #555; text-decoration: none; }
        
        .version-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 32px; }
        
        .version-card { 
            background: white; border-radius: 20px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.03); border: 2px solid transparent;
            display: flex; flex-direction: column;
            overflow: hidden;
            transition: all 0.2s ease;
            text-decoration: none; color: inherit;
            position: relative;
            height: 400px;
        }
        .version-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(0,0,0,0.08); }
        .version-card.focused { border-color: #3e31d5; box-shadow: 0 0 0 4px rgba(62, 49, 213, 0.2); transform: scale(1.02); z-index: 10; }
        
        /* Live Thumbnail Frame */
        .thumbnail { width: 100%; height: 240px; background: #fff; overflow: hidden; position: relative; border-bottom: 1px solid #eee; }
        .thumb-frame {
            width: 400%; height: 400%; /* Scale content */
            border: none;
            transform: scale(0.25);
            transform-origin: 0 0;
            pointer-events: none; /* Disable interaction in thumb */
        }
        
        .content { padding: 24px; display: flex; flex-direction: column; gap: 8px; flex: 1; }
        
        .badges { display: flex; gap: 6px; margin-bottom: 4px; }
        .tag { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 700; text-transform: uppercase; }
        .tag.latest { background: #e8f2ff; color: #0071e3; }
        .tag.version { background: #f5f5f7; color: #666; }

        .title { font-weight: 700; font-size: 18px; color: #1d1d1f; line-height: 1.3; }
        .desc { font-size: 13px; color: #86868b; line-height: 1.5; margin-top: 4px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .meta { font-size: 12px; color: #999; margin-top: auto; padding-top: 16px; font-weight: 500; display: flex; justify-content: space-between; }
        
        .view-link { color: #3e31d5; font-weight: 600; display: flex; align-items: center; gap: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>Design Previews</h1>
                <p style="color:#888; margin-top:4px;">Use <strong>Arrow Keys</strong> to navigate, <strong>Enter</strong> to select.</p>
            </div>
            <a href="." class="refresh-btn">Go to Latest (1)</a>
        </header>
        
        <div class="version-grid">
            {{range $index, $element := .}}
            <a href="{{$element.Path}}" class="version-card">
                <div class="thumbnail">
                    <!-- Live Preview Iframe -->
                    <iframe src="{{$element.Path}}" class="thumb-frame" loading="lazy"></iframe>
                </div>
                <div class="content">
                    <div class="badges">
                        {{if eq $index 0}}<span class="tag latest">Latest</span>{{end}}
                        <span class="tag version">{{$element.ID}}</span>
                    </div>
                    <span class="title">{{$element.Title}}</span>
                    <span class="desc">{{$element.Description}}</span>
                    <div class="meta">
                        <span>{{$element.Date}}</span>
                        <span class="view-link">View Page &rarr;</span>
                    </div>
                </div>
            </a>
            {{end}}
        </div>
    </div>
</body>
</html>