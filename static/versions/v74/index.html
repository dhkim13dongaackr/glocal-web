<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>동아·동서 글로컬 연합대학 v74 (Infinite Focus Loop)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['SUIT', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        brand: {
                            blue: '#4132CC', 
                            mint: '#00BEB5',
                            dark: '#1d1d1f', 
                            bg: '#EBECFA',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #E5E7EB; color: #1d1d1f; font-family: 'SUIT', sans-serif; }
        
        .mobile-frame {
            width: 320px; height: 640px;
            background: #F5F7FA; border-radius: 36px; border: 8px solid #1d1d1f;
            overflow: hidden; position: relative; margin: 40px auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        }
        .notch {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 120px; height: 24px; background: #1d1d1f;
            border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; z-index: 50;
        }
        
        /* Map Area */
        .map-area {
            width: 100%; height: 75%; position: relative; overflow: hidden;
        }
        .map-bg {
            width: 100%; height: 100%; object-fit: cover; opacity: 0.6; mix-blend-mode: multiply; filter: grayscale(100%);
        }

        /* --- Infinite Carousel --- */
        .carousel-wrapper {
            position: absolute; bottom: 40px; left: 0; width: 100%; height: 110px;
            /* Flex center to hold the absolute frame */
            display: flex; align-items: center; justify-content: center;
        }

        /* 1. The Fixed Focus Frame (Always on Top) */
        .focus-frame {
            position: absolute;
            width: 280px; height: 100px;
            border: 3px solid #4132CC; /* Thicker border */
            border-radius: 20px;
            background: transparent;
            z-index: 20; pointer-events: none;
            box-shadow: 0 10px 40px rgba(65, 50, 204, 0.2);
        }
        /* Top label on the frame */
        .focus-label {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            background: #4132CC; color: white; font-size: 9px; font-weight: 800;
            padding: 2px 8px; border-radius: 10px; letter-spacing: 1px;
        }

        /* 2. Scroll Container */
        .card-scroller {
            display: flex; gap: 12px;
            overflow-x: auto; 
            scroll-snap-type: x mandatory; /* Snap mandatory */
            width: 100%; height: 100%;
            align-items: center;
            
            /* IMPORTANT: Center the snap point */
            /* Padding = (PhoneWidth - CardWidth) / 2 */
            /* (320 - 280) / 2 = 20px */
            padding-inline: 20px; 
            
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }
        .card-scroller::-webkit-scrollbar { display: none; }

        /* 3. The Cards */
        .slide-card {
            flex-shrink: 0;
            width: 280px; height: 100px;
            background: white; border-radius: 18px; /* Slightly smaller radius than frame to fit inside */
            
            scroll-snap-align: center; /* Snap to center */
            scroll-snap-stop: always; /* Force stop on each item */
            
            display: flex; overflow: hidden;
            opacity: 0.5; transform: scale(0.92); transition: 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border: 1px solid #eee;
        }
        
        /* Active State (Visual Only, Logic handled by JS for Loop) */
        .slide-card.active {
            opacity: 1; transform: scale(1);
            border-color: transparent; /* Border handled by frame */
        }

        .slide-img { width: 90px; height: 100%; object-fit: cover; background: #eee; }
        .slide-info { flex: 1; padding: 0 16px; display: flex; flex-direction: column; justify-content: center; }
        
        .slide-cat { font-size: 10px; font-weight: 700; color: #4132CC; margin-bottom: 2px; text-transform: uppercase; }
        .slide-title { font-size: 15px; font-weight: 800; color: #1d1d1f; line-height: 1.2; word-break: keep-all; }
        .slide-loc { font-size: 11px; color: #888; margin-top: 2px; }

        /* --- Map Pins --- */
        .map-pin {
            position: absolute; width: 14px; height: 14px;
            background: #999; border-radius: 50%;
            transform: translate(-50%, -50%); transition: 0.3s;
            border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .map-pin.active {
            background: #4132CC; transform: translate(-50%, -50%) scale(1.5);
            box-shadow: 0 0 0 4px rgba(65, 50, 204, 0.3); z-index: 10;
        }

    </style>
</head>
<body class="bg-[#E5E7EB] text-[#1d1d1f] font-sans antialiased overflow-x-hidden">

    <div class="max-w-[1200px] mx-auto pt-10 px-6 md:px-10 text-center relative z-10">
        <h1 class="text-3xl font-extrabold mb-2 text-brand-dark">Infinite Focus Loop</h1>
        <p class="text-gray-500 text-sm">Perfect snapping. Infinite scrolling. One-by-one.</p>
    </div>

    <div class="mobile-frame">
        <div class="notch"></div>
        
        <!-- Header -->
        <div class="absolute top-12 left-0 w-full text-center px-6 z-10 pointer-events-none">
            <p class="text-brand-blue font-bold text-xs tracking-widest mb-1">FIELD CAMPUS</p>
            <h2 class="text-xl font-black text-gray-800">캠퍼스를 넘어 현장으로</h2>
        </div>

        <!-- Map Area -->
        <div class="map-area">
            <img src="../../pictures/DJI_0938 복사.jpg" class="map-bg">
            
            <!-- Pins (Indices must match original data) -->
            <div id="pin-0" class="map-pin" style="top: 40%; left: 35%;"></div>
            <div id="pin-1" class="map-pin" style="top: 55%; left: 65%;"></div>
            <div id="pin-2" class="map-pin" style="top: 70%; left: 45%;"></div>
            <div id="pin-3" class="map-pin" style="top: 30%; left: 75%;"></div>
        </div>

        <!-- Carousel -->
        <div class="carousel-wrapper">
            
            <!-- Fixed Frame -->
            <div class="focus-frame">
                <div class="focus-label">FOCUS</div>
            </div>

            <!-- Scroller -->
            <div class="card-scroller" id="scroller">
                <!-- Javascript will inject items here -->
            </div>
        </div>

    </div>

    <script>
        // Data
        const items = [
            { id: 0, cat: 'TECH', title: '전력반도체 센터', loc: '부산테크노파크 (남구)', img: '../../pictures/Field 캠퍼스 연합전공 홍보영상 HIGH-MASTER 250915.mov_20260202_132226.682.jpg' },
            { id: 1, cat: 'MEDIA', title: '디지털 콘텐츠', loc: '콘텐츠코리아랩 (해운대구)', img: '../../pictures/Field 캠퍼스 연합전공 홍보영상 HIGH-MASTER 250915.mov_20260202_132211.153.jpg' },
            { id: 2, cat: 'OCEAN', title: '스마트 해양 랩', loc: '해양플랜트연구소 (강서구)', img: '../../pictures/464A4461.jpg' },
            { id: 3, cat: 'BIO', title: '바이오 헬스케어', loc: '대학병원 암센터 (서구)', img: '../../pictures/Field 캠퍼스 연합전공 홍보영상 HIGH-MASTER 250915.mov_20260202_132234.075.jpg' },
        ];

        const scroller = document.getElementById('scroller');
        const pins = document.querySelectorAll('.map-pin');

        // Render Cards (With Clones for Infinite Loop)
        // Order: [Last] [0, 1, 2, 3] [First] -> Simple 1-clone buffer is enough for snap
        // Better: [2, 3] [0, 1, 2, 3] [0, 1] for smoother scroll
        const clonesStart = [items[2], items[3]]; // Clones to put at start
        const clonesEnd = [items[0], items[1]];   // Clones to put at end
        
        const renderList = [...clonesStart, ...items, ...clonesEnd];

        scroller.innerHTML = renderList.map((item, index) => `
            <div class="slide-card" data-real-id="${item.id}">
                <img src="${item.img}" class="slide-img">
                <div class="slide-info">
                    <div class="slide-cat">${item.cat}</div>
                    <div class="slide-title">${item.title}</div>
                    <div class="slide-loc">${item.loc}</div>
                </div>
            </div>
        `).join('');

        // Constants
        const cardWidth = 280;
        const gap = 12;
        const itemWidth = cardWidth + gap;
        const padding = 20; // padding-inline
        const offsetStart = clonesStart.length; // 2 items before real start

        // Initial Scroll Position (Center on real Item 0)
        // ScrollLeft = (Index * ItemWidth)
        scroller.scrollLeft = (offsetStart * itemWidth);

        // Infinite Loop Logic
        let isScrolling = false;

        scroller.addEventListener('scroll', () => {
            if (isScrolling) return;

            const scrollLeft = scroller.scrollLeft;
            const maxScroll = scroller.scrollWidth - scroller.clientWidth;

            // Detect edges (with small buffer)
            if (scrollLeft <= 5) {
                // Reached start (Clone 3) -> Jump to real 3
                isScrolling = true;
                scroller.scrollLeft = (items.length + offsetStart - 2) * itemWidth + scrollLeft; // Jump forward
                requestAnimationFrame(() => isScrolling = false);
            } else if (scrollLeft >= maxScroll - 5) {
                // Reached end (Clone 0) -> Jump to real 0
                isScrolling = true;
                scroller.scrollLeft = scrollLeft - (items.length * itemWidth); // Jump backward
                requestAnimationFrame(() => isScrolling = false);
            }
            
            updateActiveState();
        });

        // Update Active State (Highlight & Pin)
        function updateActiveState() {
            // Calculate center index
            const center = scroller.scrollLeft + (scroller.clientWidth / 2);
            const index = Math.floor((center - padding) / itemWidth); // raw index in renderList
            
            // Safety check
            if (index < 0 || index >= renderList.length) return;

            const cards = document.querySelectorAll('.slide-card');
            
            // Visual Highlight
            cards.forEach(c => c.classList.remove('active'));
            if(cards[index]) cards[index].classList.add('active');

            // Map Pin Highlight
            const realId = cards[index].getAttribute('data-real-id');
            pins.forEach(p => p.classList.remove('active'));
            if(document.getElementById(`pin-${realId}`)) {
                document.getElementById(`pin-${realId}`).classList.add('active');
            }
        }

        // Initial update
        updateActiveState();

    </script>

</body>
</html>
