<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>동아·동서 글로컬 연합대학 v76 (Peeking 3D Carousel)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['SUIT', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        brand: {
                            blue: '#4132CC', 
                            mint: '#00BEB5',
                            dark: '#1d1d1f', 
                            bg: '#EBECFA',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #E5E7EB; color: #1d1d1f; font-family: 'SUIT', sans-serif; }
        
        .mobile-frame {
            width: 320px; height: 640px;
            background: #F5F7FA; border-radius: 36px; border: 8px solid #1d1d1f;
            overflow: hidden; position: relative; margin: 40px auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        }
        .notch {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 120px; height: 24px; background: #1d1d1f;
            border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; z-index: 50;
        }
        
        /* Map Area */
        .map-area {
            width: 100%; height: 75%; position: relative; overflow: hidden;
        }
        .map-bg {
            width: 100%; height: 100%; object-fit: cover; opacity: 0.6; mix-blend-mode: multiply; filter: grayscale(100%);
        }

        /* --- 3D Carousel --- */
        .carousel-wrapper {
            position: absolute; bottom: 40px; left: 0; width: 100%; height: 130px;
            display: flex; align-items: center; justify-content: center;
            perspective: 1000px;
        }

        /* Fixed Frame (Size Matched to Smaller Card) */
        .focus-frame {
            position: absolute;
            width: 240px; height: 100px; /* Reduced width for affordance */
            border: 3px solid #4132CC; border-radius: 20px;
            background: transparent;
            z-index: 20; pointer-events: none;
            box-shadow: 0 10px 40px rgba(65, 50, 204, 0.2);
        }

        /* Scroller */
        .card-scroller {
            display: flex; gap: 12px;
            overflow-x: auto; scroll-snap-type: x mandatory;
            width: 100%; height: 100%;
            align-items: center;
            padding-inline: 40px; /* (320 - 240) / 2 = 40px Center */
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }
        .card-scroller::-webkit-scrollbar { display: none; }

        /* The Cards */
        .slide-card {
            flex-shrink: 0;
            width: 240px; height: 100px; /* Smaller Card */
            background: white; border-radius: 18px;
            
            scroll-snap-align: center;
            scroll-snap-stop: always;
            
            display: flex; overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); /* Stronger shadow */
            border: 1px solid #eee;
            
            /* Initial State */
            opacity: 0.6; transform: scale(0.9) translateY(10px);
            transition: transform 0.1s linear, opacity 0.1s linear;
            will-change: transform, opacity;
        }
        
        .slide-img { width: 80px; height: 100%; object-fit: cover; background: #eee; }
        .slide-info { flex: 1; padding: 0 14px; display: flex; flex-direction: column; justify-content: center; }
        
        .slide-cat { font-size: 9px; font-weight: 700; color: #4132CC; margin-bottom: 2px; text-transform: uppercase; }
        .slide-title { font-size: 14px; font-weight: 800; color: #1d1d1f; line-height: 1.2; word-break: keep-all; }
        .slide-loc { font-size: 10px; color: #888; margin-top: 2px; }

        /* --- Map Pins --- */
        .map-pin {
            position: absolute; width: 14px; height: 14px;
            background: #999; border-radius: 50%;
            transform: translate(-50%, -50%); transition: 0.3s;
            border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .map-pin.active {
            background: #4132CC; transform: translate(-50%, -50%) scale(1.5);
            box-shadow: 0 0 0 4px rgba(65, 50, 204, 0.3); z-index: 10;
        }

    </style>
</head>
<body class="bg-[#E5E7EB] text-[#1d1d1f] font-sans antialiased overflow-x-hidden">

    <div class="max-w-[1200px] mx-auto pt-10 px-6 md:px-10 text-center relative z-10">
        <h1 class="text-3xl font-extrabold mb-2 text-brand-dark">Peeking 3D Carousel</h1>
        <p class="text-gray-500 text-sm">Next cards are clearly visible. Invites scrolling.</p>
    </div>

    <div class="mobile-frame">
        <div class="notch"></div>
        
        <div class="absolute top-12 left-0 w-full text-center px-6 z-10 pointer-events-none">
            <p class="text-brand-blue font-bold text-xs tracking-widest mb-1">FIELD CAMPUS</p>
            <h2 class="text-xl font-black text-gray-800">캠퍼스를 넘어 현장으로</h2>
        </div>

        <div class="map-area">
            <img src="../../pictures/DJI_0938 복사.jpg" class="map-bg">
            <div id="pin-0" class="map-pin" style="top: 40%; left: 35%;"></div>
            <div id="pin-1" class="map-pin" style="top: 55%; left: 65%;"></div>
            <div id="pin-2" class="map-pin" style="top: 70%; left: 45%;"></div>
            <div id="pin-3" class="map-pin" style="top: 30%; left: 75%;"></div>
        </div>

        <div class="carousel-wrapper">
            <div class="focus-frame"></div>
            <div class="card-scroller" id="scroller"></div>
        </div>

    </div>

    <script>
        const items = [
            { id: 0, cat: 'TECH', title: '전력반도체 센터', loc: '부산테크노파크 (남구)', img: '../../pictures/Field 캠퍼스 연합전공 홍보영상 HIGH-MASTER 250915.mov_20260202_132226.682.jpg' },
            { id: 1, cat: 'MEDIA', title: '디지털 콘텐츠', loc: '콘텐츠코리아랩 (해운대구)', img: '../../pictures/Field 캠퍼스 연합전공 홍보영상 HIGH-MASTER 250915.mov_20260202_132211.153.jpg' },
            { id: 2, cat: 'OCEAN', title: '스마트 해양 랩', loc: '해양플랜트연구소 (강서구)', img: '../../pictures/464A4461.jpg' },
            { id: 3, cat: 'BIO', title: '바이오 헬스케어', loc: '대학병원 암센터 (서구)', img: '../../pictures/Field 캠퍼스 연합전공 홍보영상 HIGH-MASTER 250915.mov_20260202_132234.075.jpg' },
        ];

        const scroller = document.getElementById('scroller');
        const pins = document.querySelectorAll('.map-pin');

        const clonesStart = [items[2], items[3]];
        const clonesEnd = [items[0], items[1]];
        const renderList = [...clonesStart, ...items, ...clonesEnd];

        scroller.innerHTML = renderList.map((item, index) => `
            <div class="slide-card" data-real-id="${item.id}">
                <img src="${item.img}" class="slide-img">
                <div class="slide-info">
                    <div class="slide-cat">${item.cat}</div>
                    <div class="slide-title">${item.title}</div>
                    <div class="slide-loc">${item.loc}</div>
                </div>
            </div>
        `).join('');

        const cardWidth = 240; // Smaller
        const gap = 12;
        const itemWidth = cardWidth + gap;
        const offsetStart = clonesStart.length;
        
        scroller.scrollLeft = (offsetStart * itemWidth);

        let isScrolling = false;
        let activePinIndex = -1;

        function update3DEffect() {
            const center = scroller.scrollLeft + (scroller.clientWidth / 2);
            const cards = document.querySelectorAll('.slide-card');

            cards.forEach((card) => {
                const cardCenter = card.offsetLeft + (card.offsetWidth / 2);
                const dist = Math.abs(center - cardCenter);
                
                // Wider range to affect neighbors gently
                const range = itemWidth * 1.5;
                
                if (dist < range) {
                    const ratio = dist / range;
                    
                    // Gentle 3D Motion
                    // Center: scale(1)
                    // Neighbor: scale(0.9)
                    const scale = 1 - (ratio * 0.15); 
                    const y = ratio * 15; // Only 15px down (was 30)
                    const opacity = 1 - (ratio * 0.4); // Min 0.6 visibility
                    
                    card.style.transform = `scale(${scale}) translateY(${y}px)`;
                    card.style.opacity = opacity;
                    card.style.zIndex = 10;
                } else {
                    card.style.transform = `scale(0.85) translateY(15px)`;
                    card.style.opacity = 0.4;
                    card.style.zIndex = 1;
                }
            });

            // Update Pins
            const activeIndex = Math.floor((center - (scroller.clientWidth - itemWidth)/2) / itemWidth);
            // Re-calculate padding effect: scroller.clientWidth/2 - itemWidth/2 = Padding
            
            // Simple center detection
            let closestIndex = -1;
            let minDist = Infinity;
            
            cards.forEach((card, idx) => {
                const cardCenter = card.offsetLeft + (card.offsetWidth / 2);
                const dist = Math.abs(center - cardCenter);
                if(dist < minDist) {
                    minDist = dist;
                    closestIndex = idx;
                }
            });

            if (activePinIndex !== closestIndex && closestIndex !== -1) {
                activePinIndex = closestIndex;
                if(renderList[closestIndex]) {
                    const realId = renderList[closestIndex].id;
                    pins.forEach(p => p.classList.remove('active'));
                    if(document.getElementById(`pin-${realId}`)) {
                        document.getElementById(`pin-${realId}`).classList.add('active');
                    }
                }
            }
        }

        scroller.addEventListener('scroll', () => {
            if (isScrolling) return;

            const scrollLeft = scroller.scrollLeft;
            const maxScroll = scroller.scrollWidth - scroller.clientWidth;

            if (scrollLeft <= 5) {
                isScrolling = true;
                scroller.scrollLeft = (items.length + offsetStart - 2) * itemWidth + scrollLeft;
                requestAnimationFrame(() => isScrolling = false);
            } else if (scrollLeft >= maxScroll - 5) {
                isScrolling = true;
                scroller.scrollLeft = scrollLeft - (items.length * itemWidth);
                requestAnimationFrame(() => isScrolling = false);
            }
            
            requestAnimationFrame(update3DEffect);
        });

        update3DEffect();

    </script>

</body>
</html>
